{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<h2>Welcome, {{ user }}!</h2>

<!-- Add Task Form -->
<form method="post" class="row g-3">
    <div class="col-md-4">
        <input type="text" name="task" placeholder="Task" class="form-control" required>
    </div>
    <div class="col-md-3">
        <input type="date" name="date" class="form-control" required>
    </div>
    <div class="col-md-2">
        <input type="time" name="start" class="form-control" value="09:00" required>
    </div>
    <div class="col-md-2">
        <input type="time" name="end" class="form-control" value="17:00" required>
    </div>
    <div class="col-md-1">
        <button class="btn btn-success w-100">Add</button>
    </div>
</form>

<hr>

<!-- Tasks Table -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Date</th>
            <th>Task</th>
            <th>Image</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ task[0] }}</td> <!-- Date -->
            <td>{{ task[1] }}</td> <!-- Task Description -->
            <td>
                {% if task[2] %}
                    <img src="{{ url_for('static', filename=task[2]) }}" width="100">
                {% else %}
                    No image available
                {% endif %}
            </td>
            <td>{{ task[3] }}</td> <!-- Status -->
            <td>
                <a href="{{ url_for('main.delete_task', task_id=task[4], date=task[0]) }}" class="btn btn-danger btn-sm">Delete</a>
                <a href="{{ url_for('main.send_email', task_id=task[4], date=task[0]) }}" class="btn btn-outline-primary btn-sm">Email</a>
                <a href="{{ url_for('main.mark_as_done', task_id=task[4], date=task[0]) }}" class="btn btn-info btn-sm">Mark as Done</a>
                <a href="{{ url_for('main.generate_qr', task_id=task[4], date=task[0]) }}" class="btn btn-secondary btn-sm" download>Download QR</a>

                <form action="{{ url_for('main.upload_picture') }}" method="post" enctype="multipart/form-data" style="display:inline;">
                    <input type="hidden" name="task_id" value="{{ task[4] }}">
                    <input type="hidden" name="date" value="{{ task[0] }}">
                    <input type="file" name="picture" accept="image/*" required>
                    <button type="submit" class="btn btn-warning btn-sm">Add Picture</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Export PDF Button -->
<a href="{{ url_for('main.export_pdf') }}" class="btn btn-secondary">Export PDF</a>

<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
